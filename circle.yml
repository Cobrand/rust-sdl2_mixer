machine:
  timezone:
    Asia/Chongqing
  environment:
    LD_LIBRARY_PATH: /usr/local/lib
  pre:
    - curl -sS https://static.rust-lang.org/rustup.sh | sudo sh
    - sed -i 's/github/git-non-exist-hub/g' ~/.gitconfig

dependencies:
  cache_directories:
    - SDL2-2.0.3
    - SDL2_mixer-2.0.0
  pre:
    - echo CPU Cores $(cat /proc/cpuinfo | grep processor | wc -l)
    - >
      if [[ ! -e SDL2-2.0.3 ]]; then
        time wget -q https://www.libsdl.org/release/SDL2-2.0.3.tar.gz;
        time tar xf SDL2-*.tar.gz;
        cd SDL2-* && ./configure && make -j $(cat /proc/cpuinfo | grep processor | wc -l);
      fi
    - cd SDL2-* && sudo make install
    - >
      if [[ ! -e SDL2_mixer-2.0.0 ]]; then
        time wget -q https://www.libsdl.org/projects/SDL_mixer/release/SDL2_mixer-2.0.0.tar.gz;
        time tar xf SDL2_mixer-*.tar.gz;
        cd SDL2_mixer-* && ./configure && make -j  -j $(cat /proc/cpuinfo | grep processor | wc -l);
      fi
    - cd SDL2_mixer-* && sudo make install

test:
  override:
    - cargo build -v
    - cargo test -v
